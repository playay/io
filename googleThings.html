<div>
    <!-- 谷歌分析 -->
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-62897210-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'UA-62897210-2');
    </script>

    <!-- 谷歌一键登录 -->
    <script src="https://smartlock.google.com/client"></script>
    <script>
        function signOut() {
            googleyolo.disableAutoSignIn().then(() => {
                WithFParams.postForm('/login/signOut', {},
                    function loginResultHandler(result) {
                        localStorage.removeItem('accessToken')
                        localStorage.removeItem('userAvatar')
                        localStorage.removeItem('userName')
                        $("#signInButton").show()
                        $("#userAvatarAndName").hide()
                    }
                )
            })
        }
        function signIn() {
            $('#signInSpinner').show()
            retrievePromise = googleyolo.retrieve({
                supportedAuthMethods: [
                    "https://accounts.google.com"
                ],
                supportedIdTokenProviders: [
                    {
                        uri: "https://accounts.google.com",
                        clientId: "1093205252929-cm3ev302entgv6kutudb7i077je31g3r.apps.googleusercontent.com"
                    }
                ]
            });
            retrievePromise.then((credential) => {
                $('#signInSpinner').hide()
                if (credential.idToken) {
                    useGoogleIdTokenForAuth(credential.idToken)
                }
            }, (error) => {
                $('#signInSpinner').hide()
                if (error.type === 'requestFailed') {
                    alert('谷歌一键登录操作失败, 请确认网络环境')
                }
                if (error.type === 'noCredentialsAvailable') {
                    alert('谷歌一键登录操作失败, 未找到已登录的谷歌账号。请先在浏览器其他窗口登录任一谷歌产品')
                }
            });
        }

        function useGoogleIdTokenForAuth(idToken) {
            WithFParams.postForm('/login/withGoogle',
                {
                    "idToken": idToken
                },
                function loginResultHandler(result) {
                    if (result.success) {
                        localStorage.accessToken = result.data.accessToken
                        localStorage.userAvatar = result.data.userAvatar
                        localStorage.userName = result.data.userName
                        loadUserAvatarAndNameFormLocalStorage2ShowInNavBar()
                    } else {
                        localStorage.removeItem('accessToken')
                        console.log(result.message)
                    }
                }
            )
        }
        window.onGoogleYoloLoad = (googleyolo) => {
            googleyolo = googleyolo
            if (localStorage.accessToken) {
                $("#signInButton").hide()
            } else {
                $("#signInButton").show()
            }
        }
    </script>
</div>
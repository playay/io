---
title: fredis
layout: default
keywords: [redis, redis GUI, redis client]
description: fredis 是一个网页版 redis 客户端，基于“ws2s项目”开发。有基本的GUI图形界面，能编辑保存服务器信息、提供 redis 命令行终端、保存历史命令。所有数据存储在 localStorage, 保证数据安全。
---
<style type="text/css">
    .sortable-ghost {
        padding-left: 10px;
        background:#eee;
    }
    .sortable-drag {
        padding-left: 10px;
        background: #eee;
        border: 1px solid #E5E5E5;
        transform:rotate(3deg);
    }
</style>
{% raw %}
<div id="main" class="uk-height-1-1">
    <div class="uk-flex uk-height-1-1">
        <div style="width:24%;min-width:260px;margin-right:10px;padding-bottom:50px;" 
            class="uk-height-1-1">
            <button class="uk-button uk-width-1-1" v-on:click="editOne()">add new connection</button>
            <draggable v-model="redisConnections" element="ul" @sort="onConnectionsSorted"
                    :options="{delay:100, ghostClass:'sortable-ghost', dragClass:'sortable-drag'}" 
                    class="uk-list uk-height-1-1" id="connection-list" style="overflow-y:scroll;display:none;margin-top:0px;">
                <li v-for="connection in redisConnections" style="padding-bottom:5px;padding-top:5px;">
                    <span>{{connection.name}}</span>
                    <button class="uk-button" style="float:right;"
                            v-bind:class="{'uk-button-success': openedConnections.includes(connection)}" 
                            v-on:click="connect(connection)">
                            connect<span style="display:none" v-bind:tname="'fredis_'+connection.name">..</span>
                    </button>
                    <button class="uk-button" style="float:right;" v-on:click="editOne(connection)">edit</button>
                </li>
            </draggable>
        </div>
        <div style="width:75%;min-width:860px;" class="uk-height-1-1">
            <div tname="edit" class="uk-width-1-1">
                <div class="uk-grid uk-grid-small uk-form uk-width-1-1" 
                     style="padding-top:10px;padding-left:12%;padding-right:20%;">
                     <div class="uk-width-8-10" style="height:210px;">
                        <ul id="edit-form" class="uk-switcher" style="font-size:12px;">
                            <li>
                                <div class="uk-form-row">
                                    <input class="uk-width-1-1" v-model="form.name" placeholder="name">
                                </div>
                                <div class="uk-form-row">
                                    <input class="uk-width-1-1" v-model="form.ws2sServer" placeholder="ws2s server">
                                </div>
                                <div class="uk-form-row">
                                    <input class="uk-width-7-10" v-model="form.host" placeholder="host">
                                    <input class="uk-width-2-10" style="float:right;" v-model.number="form.port" type="number" placeholder="port">
                                </div>
                                <div class="uk-form-row">
                                    <input class="uk-width-1-1" v-model="form.auth" type="password" placeholder="auth (optional)">
                                </div>
                            </li>
                            <li>
                                <div class="uk-form-row">
                                    <input class="uk-width-7-10" v-model="form.sshHost" placeholder="ssh host">
                                    <input class="uk-width-2-10" style="float:right;" v-model.number="form.sshPort" type="number" placeholder="ssh port">
                                </div>
                                <div class="uk-form-row">
                                    <input class="uk-width-1-1" v-model="form.sshUsername" placeholder="ssh username">
                                </div>
                                <div class="uk-form-row">
                                    <input class="uk-width-1-1" v-model="form.sshPassword" type="password" placeholder="ssh password (if need)">
                                </div>
                                <div class="uk-form-row">
                                    <input class="uk-width-1-1" v-model="form.sshPrivateKey" type="text" placeholder="file path of ssh_private_key (if need), ws2s server will access this file locally">
                                </div>
                                <div class="uk-form-row">
                                    <input class="uk-width-1-1" v-model="form.sshPrivateKeyPassword" type="text" placeholder="password for an encrypted ssh_private_key (if need)">
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="uk-width-2-10">
                        <ul class="uk-tab uk-tab-right" style="font-size: 12px;" data-uk-switcher="{connect:'#edit-form'}">
                            <li><a href="#">base</a></li>
                            <li><a href="#">ssh tunnel</a></li>
                        </ul>
                    </div>
                    <div class="uk-form-row uk-width-8-10" style="margin-top:15px;">
                        <button class="uk-button uk-button-danger"
                                style="display:none;width:20%;"
                                v-show="redisConnections.includes(editingConnection)" 
                                v-on:click="deleteOne()">delete</button>
                        <button class="uk-button uk-button-primary"
                                style="float:right;width:20%;"
                                v-on:click="saveOne(form)">save</button>
                    </div>
                </div>
                <hr style="margin-top:20px;margin-bottom:20px;">
                <div class="uk-grid uk-grid-small">
                    <div class="uk-width-8-10">
                        <ul id="faq" class="uk-switcher" style="font-size: 12px;">
                            <li>
                                运行在浏览器上的 js, 只能使用 http、websocket 协议发出网络请求. 然而, redis 客户端需要使用 socket 与服务端通信. <br><br>
                                <a href="https://github.com/playay/ws2s" target="_blank">ws2s server</a> 是一个 websocket 服务端. 按约定的数据格式与它通信. 它就能帮你: <br>
                                &nbsp;&nbsp;&nbsp;&nbsp;1. 与 redis 服务端建立 socket 连接. <br>
                                &nbsp;&nbsp;&nbsp;&nbsp;2. 使用这个 socket 连接发送数据. <br>
                                &nbsp;&nbsp;&nbsp;&nbsp;3. 当这个 socket 连接收到数据时, 把收到的数据通知给你.
                            </li>
                            <li>
                                一开始, 作者使用 <a href="https://redisdesktop.com/" target="_blank">RDM</a>。 但是这个 redis 图形界面的客户端, 默认情况下有很多让人难受的地方: <br>
                                &nbsp;&nbsp;&nbsp;&nbsp;1. 双击打开一个连接, 会自动 select 所有的 db。 要等待扫描完成后才能进行下一步操作。这一过程可能会持续很长时间。<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;2. 双击打开一个 db, 会扫描所有的 key, 这一操作不仅仅是扫描, 还会真实删除已经过期的 key, 占用大量服务器资源。<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;3. 命令行终端的交互极不友好: 光标位置必需在最后一行、窗口大小被限制在非常小的比例、<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;...<br><br>
                                fredis 的初心, 是希望有个地方能单纯的: <br>
                                &nbsp;&nbsp;&nbsp;&nbsp;1. 保存账号密码。<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;2. 快速打开连接, 执行一条命令<br>
                            </li>
                            <li>ws2s 安装实践(一)...待续</li>
                            <li>ws2s 安装实践(二)...待续</li>
                        </ul>
                    </div>
                    <div class="uk-width-2-10">
                        <ul class="uk-tab uk-tab-right" style="font-size: 12px;" data-uk-switcher="{connect:'#faq'}">
                            <li><a href="#">什么是ws2s?</a></li>
                            <li><a href="#">为什么开发fredis?</a></li>
                            <li><a href="#">ws2s 安装实践(一)</a></li>
                            <li><a href="#">ws2s 安装实践(二)</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div style="display:none" class="uk-width-1-1 uk-height-1-1" 
                v-for="connection in redisConnections" :tname="'fredis_'+connection.name">
                <div class="uk-width-1-1" style="display:none">
                    <button class="uk-button copy-last-response" style="float:left;"
                        v-bind:responseKey="'fredis_'+connection.name">copy last response</button>
                    <a id="dl"></a>
                </div>
                <div class="uk-width-1-1 uk-height-1-1">
                    <div class="terminals"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endraw %}

<script src="//cdn.feling.io/js/ws2s-2.1.0.js"></script>
<script src="//cdn.feling.io/js/clipboard.min.js"></script>
<script src="//cdn.feling.io/js/jquery.terminal.min.js"></script>
<script src="//cdn.feling.io/js/Sortable.min.js"></script>
<script src="//cdn.feling.io/js/vuedraggable.min.js"></script>
<script>
    new ClipboardJS('.copy-last-response', {
        text: function(trigger) {
            return vm.lastResponse.get(trigger.getAttribute('responseKey'))
        }
    })
    var vm = new Vue({
        el: "#main",
        data: {
            redisConnections: [],
            openedConnections: [],
            editingConnection: {},
            form: {
                name: '',
                ws2sServer: 'ws://localhost:3613/',
                host: '',
                port: 6379,
                auth: '',
                sshHost: '',
                sshPort: 22,
                sshUsername: '',
                sshPassword: '',
                sshPrivateKey: '',
                sshPrivateKeyPassword: '',
            },
            lastResponse: new Map(),
        },
        mounted: function () {
            if (!localStorage.redis_connections || localStorage.redis_connections === '[]') {
                localStorage.redis_connections = JSON.stringify([{
                    name: 'try fredis',
                    ws2sServer: "wss://ws2s.feling.io/",
                    host: "172.17.248.195",
                    port: 6379,
                    auth: '',
                    sshHost: '',
                    sshPort: '',
                    sshUsername: '',
                    sshPassword: '',
                    sshPrivateKey: '',
                    sshPrivateKeyPassword: '',
                }])
            }
            this.redisConnections = JSON.parse(localStorage.redis_connections)
            $('#connection-list').show()
        },
        methods: {
            connect: function (connection) {
                if (this.openedConnections.includes(connection)) {
                    $('[tname]').hide()
                    $('[tname="fredis_' + connection.name + '"]').show()
                    return
                }
                var redis = new WS2S(connection.ws2sServer)
                    .newRedisCient(connection.host, connection.port, connection.auth,
                        connection.sshHost, connection.sshPort, 
                        connection.sshUsername, connection.sshPassword, 
                        connection.sshPrivateKey, connection.sshPrivateKeyPassword
                    )
                redis.onSocketReady = () => {
                    var terminal = $('div[tname="fredis_' + connection.name + '"]')
                                    .find(".terminals").terminal(function (command, term) {
                        command = command.trim()
                        if (command === 'help') {
                            term.echo('cp    copy last response. note that the response "OK" is not considered as a last response.')
                            term.echo('dl    download last response.')
                            term.echo('jq    format last response as json by the online json format tool on a new tab.')
                            return
                        }
                        if (command === 'dl') {
                            let lastResponse = vm.lastResponse.get('fredis_' + connection.name)
                            if (!lastResponse) {
                                term.error('last response is empty.')
                                return
                            }
                            let a = document.getElementById("dl")
                            let file = new Blob([lastResponse], {type: 'text/plain'})
                            a.href = URL.createObjectURL(file)
                            a.download = 'fredis_response.txt'
                            a.click()
                            term.echo('dl done')
                            return
                        }
                        if (command === 'cp') {
                            let lastResponse = vm.lastResponse.get('fredis_' + connection.name)
                            if (!lastResponse) {
                                term.error('last response is empty.')
                                return
                            }
                            if (lastResponse.length > 1024 * 16) {
                                term.error('response is too large to copy. please try "dl" command.')
                                return
                            }
                            $('button[responseKey="fredis_' + connection.name +'"]').click()
                            term.echo('cp done')
                            return
                        }
                        if (command === 'jq') {
                            let lastResponse = vm.lastResponse.get('fredis_' + connection.name)
                            if (!lastResponse) {
                                term.error('last response is empty.')
                                return
                            }
                            if (lastResponse.length > 1024 * 128) {
                                term.error('response is too large. please try "dl" command.')
                                return
                            }
                            localStorage.json_jsonSrc = lastResponse
                            window.open("/json/", "_blank")
                            return
                        }
                        redis.request(command)
                    }, {
                        exit: false,
                        memory: true,
                        history: false,
                        onBeforeCommand: (terminal, command) => {
                            if (command) {
                                let historyKey = 'fredis_' + connection.name + '_history'
                                terminal.history().append(command)
                                localStorage.setItem(historyKey, JSON.stringify(terminal.history().data()))
                            }
                            return true
                        },
                        onInit: (terminal) => {
                            let historyKey = 'fredis_' + connection.name + '_history'
                            if(localStorage.getItem(historyKey) === null){
                                localStorage.setItem(historyKey, '[]')
                            }
                            JSON.parse(localStorage.getItem(historyKey)).forEach(command => {
                                terminal.history().append(command)
                            })
                        },
                        greetings: 'fredis, powered by ws2s project: https://github.com/playay/ws2s'
                            + '\n\n'
                            + 'connected to ' + connection.name
                            + '(' + connection.host + ':' + connection.port + ')'
                            + ', you can now exec redis commands.\ntry `help` to get more specific commands.',
                        name: 'fredis_' + connection.name,
                        height: '100%',
                        width: '100%',
                        prompt: '> '
                    })
                    redis.onResponse = (data) => {
                        if (data !== 'OK') {
                            vm.lastResponse.set('fredis_' + connection.name, data)
                        }
                        if (data.length > 1024 * 16) {
                            terminal.error('response is too large to print. try "dl" command to download last response.')
                        } else {
                            terminal.echo(String(data))
                        }
                    }
                    redis.onError = (error) => {
                        terminal.error(JSON.stringify(error))
                    }
                    this.openedConnections.push(connection)
                    $('[tname]').hide()
                    $('[tname="fredis_' + connection.name + '"]').show()
                }
            },
            deleteOne: function () {
                var index = this.redisConnections.indexOf(this.editingConnection)
                if (index !== -1) {
                    this.redisConnections.splice(index, 1)
                    localStorage.redis_connections = JSON.stringify(this.redisConnections)
                    this.editOne()
                }
            },
            editOne: function (connection) {
                if (connection) {
                    this.editingConnection = connection
                    this.form = JSON.parse(JSON.stringify(connection))
                } else {
                    this.editingConnection = {
                        name: '',
                        ws2sServer: 'ws://localhost:3613/',
                        host: '',
                        port: 6379,
                        auth: '',
                        sshHost: '',
                        sshPort: 22,
                        sshUsername: '',
                        sshPassword: '',
                        sshPrivateKey: '',
                        sshPrivateKeyPassword: '',
                    }
                    this.form = {
                        name: '',
                        ws2sServer: 'ws://localhost:3613/',
                        host: '',
                        port: 6379,
                        auth: '',
                        sshHost: '',
                        sshPort: 22,
                        sshUsername: '',
                        sshPassword: '',
                        sshPrivateKey: '',
                        sshPrivateKeyPassword: '',
                    }
                }
                $('[tname]').hide()
                $('[tname="edit"]').show()
            },
            saveOne: function (formConnection) {
                if (!formConnection.name) {
                    formConnection.name = formConnection.host + ':' + formConnection.port
                }
                var index = this.redisConnections.indexOf(this.editingConnection)
                if (index !== -1) {
                    if (this.editingConnection.name != formConnection.name) {
                        let oldHistory = 'fredis_' + this.editingConnection.name + '_history'
                        let newHistory = 'fredis_' + formConnection.name + '_history'
                        localStorage.setItem(newHistory, localStorage.getItem(oldHistory))
                        localStorage.removeItem(oldHistory)
                    }
                    this.redisConnections.splice(index, 1, formConnection)
                } else {
                    this.redisConnections.push(JSON.parse(JSON.stringify(formConnection)))
                }
                localStorage.redis_connections = JSON.stringify(this.redisConnections)
                this.editOne()
            },
            onConnectionsSorted: function () {
                localStorage.redis_connections = JSON.stringify(this.redisConnections)
            },
        }
    })
</script>
<link rel="stylesheet" href="//cdn.feling.io/css/jquery.terminal.min.css" media="all">
<style>
.terminal, .cmd {
    font-family: Consolas, monospace;
}
</style>

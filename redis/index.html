---
title: fredis
layout: default
keywords: [redis, redis GUI, redis client]
description: fredis 是一个网页版 redis 客户端，基于“ws2s项目”开发。有基本的GUI图形界面，能编辑保存服务器信息、提供 redis 命令行终端、保存历史命令。所有数据存储在 localStorage。
---

{% raw %}
<div id="main" class="uk-height-1-1">
    <div class="uk-flex uk-height-1-1">
        <div style="width:24%;margin-right:10px;padding-bottom:50px;" 
            class="uk-height-1-1">
            <button class="uk-button uk-width-1-1" v-on:click="editOne()">add new connection</button>
            <ul class="uk-list uk-list-line uk-height-1-1" id="connection-list" style="overflow:scroll;display:none;">
                <li v-for="connection in redisConnections">
                    <span>{{connection.name}}</span>
                    <button class="uk-button" style="float:right;"
                            v-bind:class="{'uk-button-success': openedConnections.includes(connection)}" 
                            v-on:click="connect(connection)">connect
                            <span style="display:none" v-bind:tname="'fredis_'+connection.name">..</span></button>
                    <button class="uk-button" style="float:right;" v-on:click="editOne(connection)">edit</button>
                </li>
            </ul>
        </div>
        <div style="width:75%;" class="uk-height-1-1">
            <div tname="edit" class="uk-width-1-1">
                <div class="uk-form uk-width-1-1" 
                     style="padding-top:10px;padding-left:20%;padding-right:35%;">
                    <div class="uk-form-row">
                        <input class="uk-width-1-1" v-model="form.name" placeholder="name">
                    </div>
                    <div class="uk-form-row">
                        <input class="uk-width-1-1" v-model="form.ws2sServer" placeholder="ws2s server">
                    </div>
                    <div class="uk-form-row">
                        <input class="uk-width-7-10" v-model="form.host" placeholder="host">
                        <input class="uk-width-2-10" style="float:right;" v-model.number="form.port" type="number" placeholder="port">
                    </div>
                    <div class="uk-form-row">
                        <input class="uk-width-1-1" v-model="form.auth" type="password" placeholder="auth (optional)">
                    </div>
                    <div class="uk-form-row">
                        <button class="uk-button uk-button-danger"
                                style="display:none;width:30%;"
                                v-show="redisConnections.includes(form)" 
                                v-on:click="deleteOne(form)">delete</button>
                        <button class="uk-button uk-button-primary"
                                style="float:right;width:30%;"
                                v-on:click="saveOne(form)">save</button>
                    </div>
                </div>
                <hr style="margin-top:10px;margin-bottom:10px;">
                <div class="uk-grid uk-grid-small">
                    <div class="uk-width-8-10">
                        <ul id="faq" class="uk-switcher">
                            <li>
                                运行在浏览器上的 js, 只能使用 http、websocket 协议发出网络请求. 然而, redis 客户端需要使用 socket 与服务端通信. <br><br>
                                <a href="https://github.com/playay/ws2s" target="_blank">ws2s server</a> 是一个 websocket 服务端. 按约定的数据格式与它通信. 它就能帮你: <br>
                                1. 与 redis 服务端建立 socket 连接. <br>
                                2. 使用这个 socket 连接发送数据. <br>
                                3. 当这个 socket 连接收到数据时, 把收到的数据通知给你.
                            </li>
                        </ul>
                    </div>
                    <div class="uk-width-2-10">
                        <ul class="uk-tab uk-tab-right" data-uk-switcher="{connect:'#faq'}">
                            <li><a href="#">什么是ws2s?</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div style="display:none" class="uk-width-1-1 uk-height-1-1" 
                v-for="connection in redisConnections" :tname="'fredis_'+connection.name">
                <div class="uk-width-1-1" style="display:none">
                    <button class="uk-button copy-last-response" style="float:left;"
                        v-bind:responseKey="'fredis_'+connection.name">copy last response</button>
                    <a id="dl"></a>
                </div>
                <div class="uk-width-1-1 uk-height-1-1">
                    <div class="terminals"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endraw %}

<script>{% include js/ws2s-2.0.1.js %}</script>
<script>{% include js/clipboard.min.js %}</script>
<script>{% include js/jquery.terminal.min.js %}</script>

<script>
    new ClipboardJS('.copy-last-response', {
        text: function(trigger) {
            return vm.lastResponse.get(trigger.getAttribute('responseKey'))
        }
    })
    var vm = new Vue({
        el: "#main",
        data: {
            redisConnections: [],
            openedConnections: [],
            editingConnection: {},
            form: {
                name: '',
                ws2sServer: '',
                host: '',
                port: 6379,
                auth: ''
            },
            lastResponse: new Map(),
        },
        mounted: function () {
            if (!localStorage.redis_connections || localStorage.redis_connections === '[]') {
                localStorage.redis_connections = JSON.stringify([{
                    name: 'try fredis',
                    ws2sServer: "wss://ws2s.feling.io/",
                    host: "172.17.248.195",
                    port: 6379,
                    auth: ''
                }])
            }
            this.redisConnections = JSON.parse(localStorage.redis_connections)
            $('#connection-list').show()
        },
        methods: {
            connect: function (connection) {
                if (this.openedConnections.includes(connection)) {
                    $('[tname]').hide()
                    $('[tname="fredis_' + connection.name + '"]').show()
                    return
                }
                var redis = new WS2S(connection.ws2sServer)
                    .newRedisCient(connection.host, connection.port, connection.auth)
                redis.onReady = () => {
                    var terminal = $('div[tname="fredis_' + connection.name + '"]')
                                    .find(".terminals").terminal(function (command, term) {
                        command = command.trim()
                        if (command === 'help') {
                            term.echo('cp    copy last response. note that the response "OK" is not considered as a last response.')
                            term.echo('dl    download last response.')
                            term.echo('jq    format last response as json by the online json format tool on a new tab.')
                            return
                        }
                        if (command === 'dl') {
                            let lastResponse = vm.lastResponse.get('fredis_' + connection.name)
                            if (!lastResponse) {
                                term.error('last response is empty.')
                                return
                            }
                            let a = document.getElementById("dl")
                            let file = new Blob([lastResponse], {type: 'text/plain'})
                            a.href = URL.createObjectURL(file)
                            a.download = 'fredis_response.txt'
                            a.click()
                            term.echo('dl done')
                            return
                        }
                        if (command === 'cp') {
                            let lastResponse = vm.lastResponse.get('fredis_' + connection.name)
                            if (!lastResponse) {
                                term.error('last response is empty.')
                                return
                            }
                            if (lastResponse.length > 1024 * 16) {
                                term.error('response is too large to copy. please try "dl" command.')
                                return
                            }
                            $('button[responseKey="fredis_' + connection.name +'"]').click()
                            term.echo('cp done')
                            return
                        }
                        if (command === 'jq') {
                            let lastResponse = vm.lastResponse.get('fredis_' + connection.name)
                            if (!lastResponse) {
                                term.error('last response is empty.')
                                return
                            }
                            if (lastResponse.length > 1024 * 128) {
                                term.error('response is too large. please try "dl" command.')
                                return
                            }
                            localStorage.json_jsonSrc = lastResponse
                            window.open("/json/", "_blank")
                            return
                        }
                        redis.request(command)
                    }, {
                        exit: false,
                        memory: true,
                        history: false,
                        onBeforeCommand: (terminal, command) => {
                            if (command) {
                                let historyKey = 'fredis_' + connection.name + '_history'
                                terminal.history().append(command)
                                localStorage.setItem(historyKey, JSON.stringify(terminal.history().data()))
                            }
                            return true
                        },
                        onInit: (terminal) => {
                            let historyKey = 'fredis_' + connection.name + '_history'
                            if(localStorage.getItem(historyKey) === null){
                                localStorage.setItem(historyKey, '[]')
                            }
                            JSON.parse(localStorage.getItem(historyKey)).forEach(command => {
                                terminal.history().append(command)
                            })
                        },
                        greetings: 'fredis, powered by ws2s project: https://github.com/playay/ws2s'
                            + '\n\n'
                            + 'connected to ' + connection.name
                            + '(' + connection.host + ':' + connection.port + ')'
                            + ', you can now exec redis commands.\ntry "help" to get more specific commands.',
                        name: 'fredis_' + connection.name,
                        height: '100%',
                        width: '100%',
                        prompt: '> '
                    })
                    redis.onResponse = (data) => {
                        if (data !== 'OK') {
                            vm.lastResponse.set('fredis_' + connection.name, data)
                        }
                        if (data.length > 1024 * 16) {
                            terminal.error('response is too large to print. try "dl" command to download last response.')
                        } else {
                            terminal.echo(String(data))
                        }
                    }
                    redis.onError = (error) => {
                        terminal.error(JSON.stringify(error))
                    }
                    this.openedConnections.push(connection)
                    $('[tname]').hide()
                    $('[tname="fredis_' + connection.name + '"]').show()
                }
            },
            deleteOne: function (connection) {
                var index = this.redisConnections.indexOf(connection)
                if (index !== -1) {
                    this.redisConnections.splice(index, 1)
                    localStorage.redis_connections = JSON.stringify(this.redisConnections)
                    this.editOne()
                }
            },
            editOne: function (connection) {
                if (connection) {
                    this.editingConnection = connection
                    this.form = connection
                } else {
                    this.editingConnection = { name: '', ws2sServer: '', host: '', port: 6379, auth: '' }
                    this.form = { name: '', ws2sServer: '', host: '', port: 6379, auth: '' }
                }
                $('[tname]').hide()
                $('[tname="edit"]').show()
            },
            saveOne: function (connection) {
                if (!connection.name) {
                    connection.name = connection.host + ':' + connection.port
                }
                var index = this.redisConnections.indexOf(this.editingConnection)
                if (index !== -1) {
                    this.redisConnections.splice(index, 1, connection)
                } else {
                    this.redisConnections.push(JSON.parse(JSON.stringify(connection)))
                }
                localStorage.redis_connections = JSON.stringify(this.redisConnections)
                this.editOne()
            },
        }
    })
</script>
<style>{% include css/jquery.terminal.min.css %}</style>

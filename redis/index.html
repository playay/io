---
title: fredis
layout: default
keywords: [redis]
description: web 版 redis 客户端--fredis，基于 ws2s.js 开发。
---

{% raw %}
<div id="main" class="uk-height-1-1">
    <div class="uk-flex uk-height-1-1">
        <div style="width:30%;min-width:240px;">
            <button class="uk-button uk-button-primary uk-width-1-1" 
                    v-on:click="editOne()">add new connection</button>
            <ul class="uk-nav uk-nav-bar uk-list uk-list-line">
                <li v-for="connection in redisConnections">
                    <span>{{connection.name}}</span>
                    <button class="uk-button" 
                            v-bind:class="{uk-button-success: true}" 
                            v-on:click="connect(connection)">connect</button>
                    <!-- <button class="uk-button" v-on:click="deleteOne(connection)">delete</button> -->
                </li>
            </ul>

        </div>
        <div id="terminals" style="width:100%;">
            <div tname="edit">

            </div>
            <div v-for="connection in redisConnections" :tname="'fredis_'+connection.name"></div>
        </div>
    </div>
</div>

<script src="https://gitee.com/chenyanclyz/ws2s/raw/master/ws2s-js/ws2s.js"></script>
<script src="https://cdn.rawgit.com/jcubic/jquery.terminal/master/js/jquery.terminal.min.js"></script>
<link href="https://cdn.rawgit.com/jcubic/jquery.terminal/master/css/jquery.terminal.min.css" rel="stylesheet" />

<script>

    var vm = new Vue({
        el: "#main",
        data: {
            redisConnections: [],
            openedConnections: [],
            form: {
                name: '',
                ws2sServer: '',
                host: '',
                port: 6379,
                auth: ''
            }
        },
        mounted: function () {
            if (!localStorage.redis_connections || localStorage.redis_connections === '[]') {
                localStorage.redis_connections = JSON.stringify([{
                    name: '中文带 空ghg格？#¥。',
                    ws2sServer: "wss://feling.io/ws2s-server/",
                    host: "172.17.248.195",
                    port: 6379,
                    auth: null
                }, {
                    name: 'feling',
                    ws2sServer: "wss://sg.io/ws2s-server/",
                    host: "172.17.248.195",
                    port: 6379,
                    auth: ''
                }])
            }
            this.redisConnections = JSON.parse(localStorage.redis_connections)
        },
        methods: {
            connect: function (connection) {
                if (this.openedConnections.includes(connection)) {
                    $('div[tname]').hide()
                    $('div[tname="fredis_' + connection.name + '"]').show()
                    return
                }
                this.openedConnections.push(connection)
                var redis = new WS2S(connection.ws2sServer)
                    .newRedisCient(connection.host, connection.port, connection.auth)
                redis.onReady = () => {
                    var terminal = $('div[tname="fredis_' + connection.name + '"]').terminal(function (command, term) {
                        redis.request(command)
                    }, {
                            exit: false,
                            greetings: 'fredis, powered by ws2s project: https://github.com/playlay/ws2s'
                                + '\n\n'
                                + 'connected to ' + connection.name
                                + '(' + connection.host + ':' + connection.port + ')'
                                + ', you can now exec redis commands.',
                            name: 'fredis_' + connection.name,
                            height: '100%',
                            width: '100%',
                            prompt: '> '
                        })
                    redis.onResponse = (data) => {
                        terminal.echo(String(data))
                    }
                    redis.onError = (error) => {
                        terminal.error(JSON.stringify(error))
                    }
                    $('div[tname]').hide()
                    $('div[tname="fredis_' + connection.name + '"]').show()
                }
            },
            deleteOne: function (connection) {
                var index = this.redisConnections.indexOf(connection)
                if (index !== -1) {
                    this.redisConnections.splice(index, 1)
                    localStorage.redis_connections = JSON.stringify(this.redisConnections)
                }
            },
            editOne: function (connection) {
                if (connection) {
                    this.form = connection
                } else {
                    this.form = { name: '', ws2sServer: '', host: '', port: 6379, auth: '' }
                }
            },
        }
    })
</script>
{% endraw %}
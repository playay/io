---
layout: default
keywords: [feling.io, 在线工具, json]
---


<style type="text/css">
.json_key {
    color: #92278f;
    font-weight: bold;
}
.json_string {
    color: #3ab54a;
    font-weight: bold;
}
.json_number {
    color: #25aae2;
    font-weight: bold;
}
.json_boolean {
    color: #f98280;
    font-weight: bold;
}
</style>


<div id="main" class="uk-grid uk-grid-collapse">
    <div class="uk-width-4-10" style="padding: 10px;">
        <textarea id="json_src" class="uk-width-1-1" autofocus 
        v-model="jsonSrc" v-on:change="jsonSrcChange"
        style="height: 600px;resize: vertical;font-size: 12px;">
        </textarea>
    </div>

    <div class="uk-width-6-10" style="padding: 10px;">
        <div class="uk-width-1-1"> TODO: 复制、展开</div>
        <hr>
        <div id="json_result" class="uk-width-1-1" 
        style="height: 100%;width: 100%;max-width: 100%;word-wrap: break-word; padding-top: 10px; font-size: 12px;">
            <div v-html="jsonResult"></div>
        </div>
    </div>
</div>

<div>
TODO: 历史记录、保存
</div>


<script>
    function fold(icon) {
        icon.classList.remove('uk-icon-angle-down')
        icon.classList.add('uk-icon-angle-right')
        icon.setAttribute('onClick', 'javascript: unFold(this)')
        icon.innerHTML = '...'
        icon.nextSibling.style.display = 'none'
    }
    function unFold(icon) {
        icon.classList.remove('uk-icon-angle-right')
        icon.classList.add('uk-icon-angle-down')
        icon.setAttribute('onClick', 'javascript: fold(this)')
        icon.innerHTML = ''
        icon.nextSibling.style.display = 'inline'
    }
    vm_header.current_io = 'json'
    var vm = new Vue({
        el: "#main",
        data: {
            jsonSrc: '',
            jsonResultTemp: '',
            jsonResult: '',
            tab: '&nbsp;&nbsp;&nbsp;&nbsp;'
        },
        methods: {
            isArray: function (obj) {
                return  obj && typeof obj === 'object' && typeof obj.length === 'number' && !(obj.propertyIsEnumerable('length'))
            },
            genKey: function (key, depth) {
                return "<br>"
                + "<span class='json_key'>"
                + this.tab.repeat(depth + 1)
                + "\""+ key + "\""
                + "</span>:&nbsp;"
            },
            genValue: function (obj) {
                var type = typeof obj
                if (type === 'string') {
                    return '<span class="json_string">"' + obj + '",</span>'
                }
                if (type === 'number') {
                    return '<span class="json_number">' + obj + ',</span>'
                }
                if (type === 'boolean') {
                    return '<span class="json_boolean">' + obj + ',</span>'
                }
            },
            genStart: function (start, depth) {
                if (this.jsonResultTemp === '' || this.jsonResultTemp.endsWith(':&nbsp;')) {
                    this.jsonResultTemp = this.jsonResultTemp + start
                } else {
                    this.jsonResultTemp = this.jsonResultTemp + '<br>' + this.tab.repeat(depth) + start
                }
                this.jsonResultTemp = this.jsonResultTemp + '<i class="uk-icon-angle-down" onClick="fold(this)"></i><span class="foldContent">'
            },
            genEnd: function (end, depth) {
                this.jsonResultTemp = this.deletLastComma(this.jsonResultTemp) + '<br>' + this.tab.repeat(depth) 
                + '</span>' // <span class="foldContent">
                + end + ','
            },
            deletLastComma: function (string) {
                var index = string.lastIndexOf(',')
                if (index >= 0) {
                    return string.substring(0, index) + string.substring(index + string.length);
                }
                return string
            },
            genResult: function (obj, depth) {
                if (this.isArray(obj)) {
                    this.genStart('[', depth)
                    for(var i = 0; i < obj.length; i++){
                        this.genResult(obj[i], depth + 1)
                    }
                    this.genEnd(']', depth)
                    return
                }
                if ((typeof obj) == 'object') {
                    this.genStart('{', depth)
                    for (key in obj) {
                        this.jsonResultTemp = this.jsonResultTemp + this.genKey(key, depth)
                        this.genResult(obj[key], depth + 1)
                    }
                    this.genEnd('}', depth)
                    return
                }
                this.jsonResultTemp = this.jsonResultTemp + this.genValue(obj)
            },
            jsonSrcChange: function () {
                if (this.jsonSrc === '') {
                    return
                }
                try {
                    var obj = JSON.parse(this.jsonSrc)
                    this.jsonResultTemp = ''
                    this.genResult(obj, 0)
                    this.jsonResult = this.deletLastComma(this.jsonResultTemp)
                } catch (e) {
                    // TODO src 里标记出错的位置
                    this.jsonResult = e.message;
                }
            }
        }
    })

</script>
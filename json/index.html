---
layout: default
keywords: [feling.io, 在线工具, json]
---


<style type="text/css">
.json_key {
    color: #92278f;
    font-weight: bold;
}
.json_string {
    color: #3ab54a;
    font-weight: bold;
}
.json_number {
    color: #25aae2;
    font-weight: bold;
}
.json_boolean {
    color: #f98280;
    font-weight: bold;
}
#json_src {
    height: 500px;
    resize: vertical;
    padding: 10px;
    font-size: 13px;
}
#json_result {
    height: 100%;
    width: 100%;
    max-width: 100%;
    word-wrap: break-word;
    padding: 10px;
    font-size: 13px;
}

@media (min-width: 960px) {
    #json_src_box {
        width: 40%;
    }
    #json_result_box {
        padding-left: 10px;
        width: 60%;
    }
}
@media (max-width: 960px) {
    #json_src {
        height: 240px;
    }
    #json_src_box {
        width: 100%;
    }
    #json_result_box {
        width: 100%;
    }
}

</style>


<div id="main" class="uk-grid uk-grid-collapse">
    <div id="json_src_box" class="uk-width-10-10">
        <textarea id="json_src" class="uk-width-1-1" autofocus spellcheck="false" v-model="jsonSrc" v-on:change="jsonSrcChange">
        </textarea>
    </div>

    <div id="json_result_box" class="uk-width-10-10">
        <div class="uk-width-1-1">
            <button class="uk-button" v-on:click="unFoldAll(2)">1级</button>
            <button class="uk-button uk-visible-Medium" v-on:click="unFoldAll(3)">2级</button>
            <button class="uk-button uk-visible-large" v-on:click="unFoldAll(4)">3级</button>
            <button class="uk-button uk-visible-large" v-on:click="unFoldAll(5)">4级</button>
            <button class="uk-button uk-visible-large" v-on:click="unFoldAll(6)">5级</button>
            <button class="uk-button" v-on:click="unFoldAll(999)">n级</button>
            <button class="uk-button uk-visible-large">耗时: {% raw %}{{costTime}}{% endraw %}ms</button>
            <input type="checkbox" id="array_sampling" v-model="arraySampling" v-on:change="jsonSrcChange">
            <label for="array_sampling">数组只解析首元素</label>
            <button class="uk-button" v-on:click="selectAll()" style="float: right;">全选</button>
        </div>
        <hr>
        <div id="json_result" class="uk-width-1-1">
            <div v-html="jsonResult"></div>
        </div>
    </div>
</div>

<!-- <div>
TODO: 历史记录、保存
</div> -->


<script>
    function fold(icon) {
        icon.classList.remove('uk-icon-angle-down')
        icon.classList.add('uk-icon-angle-right')
        icon.setAttribute('onClick', 'javascript: unFold(this)')
        icon.innerHTML = '...'
        icon.nextSibling.style.display = 'none'
    }
    function unFold(icon) {
        icon.classList.remove('uk-icon-angle-right')
        icon.classList.add('uk-icon-angle-down')
        icon.setAttribute('onClick', 'javascript: fold(this)')
        icon.innerHTML = ''
        icon.nextSibling.style.display = 'inline'
    }
    vm_header.current_io = 'json'
    var vm = new Vue({
        el: "#main",
        data: {
            jsonSrc: '{"siteList":["feling.io","pages.feling.net"],"number":123,"obj":{"null":null,"boolean":true},"objList":[{"key":"value"},{}]}',
            jsonResultTemp:[],
            jsonResult: '',
            tab: '&nbsp;&nbsp;&nbsp;&nbsp;',
            arraySampling: true,// 遇到数组，只解析一个元素
            costTime: ''
        },
        mounted: function () {
            this.jsonSrcChange()
        },
        methods: {
            isArray: function (obj) {
                return  obj && typeof obj === 'object' && typeof obj.length === 'number' && !(obj.propertyIsEnumerable('length'))
            },
            genKey: function (key, depth) {
                this.jsonResultTemp.push("<br><span class='json_key'>")
                this.jsonResultTemp.push(this.tab.repeat(depth + 1))
                this.jsonResultTemp.push("\"")
                this.jsonResultTemp.push(key)
                this.jsonResultTemp.push("\"</span>:&nbsp;")
            },
            genValue: function (obj, depth) {
                var value = ''
                var type = typeof obj
                if (obj === null) {
                    value = '<span class="json_boolean">null</span>,'
                } else if (type === 'string') {
                    value = '<span class="json_string">"' + obj + '"</span>,'
                } else if (type === 'number') {
                    value = '<span class="json_number">' + obj + '</span>,'
                } else if (type === 'boolean') {
                    value = '<span class="json_boolean">' + obj + '</span>,'
                }

                if (!this.jsonResultTemp[this.jsonResultTemp.length - 1].endsWith(':&nbsp;')) { // 冒号后面不换行
                    this.jsonResultTemp.push('<br>')
                    this.jsonResultTemp.push(this.tab.repeat(depth))
                }
                this.jsonResultTemp.push(value)
            },
            genStart: function (start, depth) {
                console.log('alive')
                if (!this.jsonResultTemp[this.jsonResultTemp.length - 1].endsWith(':&nbsp;') // 冒号后面不换行
                    && this.jsonResultTemplength > 0) {
                    this.jsonResultTemp.push('<br>')
                    this.jsonResultTemp.push(this.tab.repeat(depth))
                }
                this.jsonResultTemp.push(start)
                this.jsonResultTemp.push('<i class="uk-icon-angle-down" onClick="fold(this)"></i><span class="foldContent">')
            },
            genEnd: function (end, depth) {
                this.deletLastComma()
                this.jsonResultTemp.push('<br>')
                this.jsonResultTemp.push(this.tab.repeat(depth))
                this.jsonResultTemp.push('</span>') // <span class="foldContent">
                this.jsonResultTemp.push(end)
                this.jsonResultTemp.push(',')
            },
            deletLastComma: function () {
                var old = this.jsonResultTemp.pop()
                var index = string.lastIndexOf(',')
                var index1 = string.lastIndexOf('{')
                var index2 = string.lastIndexOf('[')
                if (index > index1 && index > index2) {
                    this.jsonResultTemp.push(old.substring(0, index) + old.substring(index + 1))
                }
                this.jsonResultTemp.push(old)
            },
            genResult: function (obj, depth) {
                if (this.isArray(obj)) {
                    this.genStart('[', depth)
                    for(var i = 0; i < (this.arraySampling ? Math.min(obj.length, 1) : obj.length); i++) {
                        this.genResult(obj[i], depth + 1)
                    }
                    this.genEnd(']', depth)
                    return
                }
                if ((typeof obj) === 'object' && obj !== null) {
                    this.genStart('{', depth)
                    for (key in obj) {
                        this.genKey(key, depth)
                        this.genResult(obj[key], depth + 1)
                    }
                    this.genEnd('}', depth)
                    return
                }
                this.genValue(obj, depth)
            },
            jsonSrcChange: function () {
                if (this.jsonSrc === '') {
                    return
                }
                try {
                    var startTime = new Date().getTime()
                    var obj = JSON.parse(this.jsonSrc)
                    this.jsonResultTemp = []
                    this.genResult(obj, 0)
                    // this.deletLastComma()
                    this.jsonResult = this.jsonResultTemp.join("")
                    this.costTime = new Date().getTime() - startTime
                } catch (e) {
                    // TODO src 里标记出错的位置
                    this.jsonResult = e.message;
                }
            },
            unFoldAll: function (level) {
                this.traverseChildren(
                    document.getElementById("json_result"),
                    function(element, depth) {
                        if(element.tagName === 'I'){
                            if(depth > level){
                                this.fold(element)
                            } else {
                                this.unFold(element)
                            }
                        }
                    },
                    0
                )
            },
            traverseChildren: function (element, func, depth) {
                for(var i = 0; i < element.childNodes.length; i++){
                    this.traverseChildren(element.childNodes[i], func, depth + 1)
                }
                func(element, depth)
            },
            selectAll: function () {
                var selection = window.getSelection()
                selection.removeAllRanges()

                var range = document.createRange()
                range.selectNodeContents(document.getElementById("json_result"))

                selection.addRange(range)
            }
        }
    })

</script>
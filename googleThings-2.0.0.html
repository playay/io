<div>
    <!-- 谷歌分析 -->
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-62897210-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'UA-62897210-2');
    </script>

    <!-- 谷歌登录 -->
    <script src="https://apis.google.com/js/platform.js?onload=onGapiLoad" async defer></script>
    <script>
        function useGoogleIdTokenForAuth(idToken) {
            $('#signInSpinner').show()
            WithFParams.postForm('/login/withGoogle',
                {
                    "idToken": idToken
                },
                function loginResultHandler(result) {
                    if (result.success) {
                        localStorage.accessToken = result.data.accessToken
                        localStorage.userAvatar = result.data.userAvatar
                        localStorage.userName = result.data.userName
                        loadUserAvatarAndNameFormLocalStorage2ShowInNavBar()
                    } else {
                        localStorage.removeItem('accessToken')
                    }
                }
            ).always(() => {
                $('#signInSpinner').hide()
            })
        }

        function onGapiLoad() {
            gapi.load('auth2', () => {
                var auth2 = gapi.auth2.init({
                    client_id: '1093205252929-r3fj3lliprgso4nrbtan10ugl4d7a1cl.apps.googleusercontent.com'
                })
                auth2.attachClickHandler('signInButton', {}, 
                    (googleUser) => {
                        useGoogleIdTokenForAuth(googleUser.getAuthResponse().id_token)
                    }, 
                    (error) => {
                        switch (error.error) {
                            case "popup_closed_by_user":
                                localStorage.userCanceledLogin = true
                                break
                            default:
                                UIkit.modal.alert('谷歌登录操作失败, ' + error.error)
                        }
                    }
                )
            })

            if (localStorage.accessToken) {
                $("#signInButton").hide()
            } else {
                $("#signInButton").show()
            }
        }
    </script>

</div>